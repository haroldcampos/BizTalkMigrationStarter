{
  "kind": "Stateful",
  "definition": {
    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
    "contentVersion": "1.0.0.0",
    "triggers": {
      "pipelinesend": {
        "type": "Request",
        "kind": "Http"
      }
    },
    "actions": {
      "Encode": {
        "type": "Scope",
        "actions": {
          "MIMESMIMEencoder": {
            "type": "InvokeFunction",
            "inputs": {
              "functionName": "EncodeMimeSmimeMessage",
              "parameters": {
                "messageContent": "@triggerBody()?['$content']",
                "encryptMessage": "true",
                "signMessage": "true",
                "SendBodyPartAsAttachment": "true",
                "ContentTransferEncoding": "base64",
                "SignatureType": "0",
                "EnableEncryption": "false",
                "EncryptionAlgorithm": "0",
                "AddSigningCertToMessage": "true",
                "ValidateCRL": "true"
              }
            },
            "metadata": {
              "comment": "// Component: MIME/SMIME Encoder\r\n// Description: Encodes messages in MIME/SMIME format with support for 7bit, 8bit, binary, quoted-printable, base64, and UUencode encoding. Can MIME encode, sign, or encrypt outgoing messages.\r\n// Behavior: Creates MIME structure, encrypts content using recipient certificates, adds digital signatures using group signing certificate. If signing certificate not found in group or personal store, or if encryption certificate not found, message is suspended. For request-response encryption, requires custom component to set BTS.EncryptionCert before this component.\r\n// Message Flow: 1 message in â†’ 1 message out (or suspended on certificate error)\r\n// Properties:\r\n//   SendBodyPartAsAttachment = true\r\n//   ContentTransferEncoding = base64\r\n//   SignatureType = 0\r\n//   EnableEncryption = false\r\n//   EncryptionAlgorithm = 0\r\n//   AddSigningCertToMessage = true\r\n//   ValidateCRL = true\n// ?? WARNING: MIME processing requires Azure Functions\n// IMPLEMENTATION: Deploy Azure Function with MimeKit library\n// FUNCTION NAME: EncodeMimeSmimeMessage\n// Stage: Encode (All)"
            },
            "runAfter": {}
          }
        },
        "runAfter": {}
      }
    },
    "outputs": {}
  }
}