{
  "kind": "Stateful",
  "definition": {
    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
    "contentVersion": "1.0.0.0",
    "triggers": {
      "DefaultReceiveLocation": {
        "type": "Request",
        "kind": "Http"
      }
    },
    "actions": {
      "SubmitRNIFAPI": {
        "type": "InitializeVariable",
        "inputs": {
          "variables": [
            {
              "name": "SubmitRNIFAPI",
              "type": "object",
              "value": null
            }
          ]
        },
        "runAfter": {}
      },
      "ServiceContent": {
        "type": "InitializeVariable",
        "inputs": {
          "variables": [
            {
              "name": "ServiceContent",
              "type": "string",
              "value": ""
            }
          ]
        },
        "runAfter": {
          "SubmitRNIFAPI": [
            "SUCCEEDED"
          ]
        }
      },
      "InboundMessage": {
        "type": "InitializeVariable",
        "inputs": {
          "variables": [
            {
              "name": "InboundMessage",
              "type": "object",
              "value": null
            }
          ]
        },
        "runAfter": {
          "ServiceContent": [
            "SUCCEEDED"
          ]
        }
      },
      "ConstructServiceContent_74fe76a6": {
        "type": "Compose",
        "inputs": "@'ServiceContent = HubHelper.ReturnXmlForStringInput(InboundMessage.MessagesToLOB.ServiceContent,InboundMessage(HubScenario.PIPCode))'",
        "runAfter": {
          "InboundMessage": [
            "SUCCEEDED"
          ]
        }
      },
      "CheckForCategory_2f799937": {
        "type": "If",
        "expression": "@equals(variables('InboundMessage')?['MessageCategory'], 'AsyncAction')",
        "actions": {
          "CheckForPIP_3614272f": {
            "type": "If",
            "expression": "@equals('PIPCode),\"3A4\")', true)",
            "actions": {
              "Construct3A4RequestMessage_0f572b9d": {
                "type": "Compose",
                "inputs": "@'PIP3A4ReqMessage = ServiceContent'",
                "runAfter": {}
              },
              "InvokeSubmitRNIFAPI3A4Req_3bac1dd2": {
                "type": "Compose",
                "inputs": "@'SubmitRNIFAPI.SubmitMessage(\r\nMicrosoft.Solutions.BTARN.Shared.MessageCategory.AsyncAction,\r\nInboundMessage(HubScenario.DestinationPartyName),\r\nHubHelper.GetNameFromDuns(PIP3A4ReqMessage.toRole.PartnerRoleDescription.PartnerDescription.BusinessDescription.GlobalBusinessIdentifier),\r\nInboundMessage(HubScenario.PIPCode),\r\nInboundMessage(HubScenario.PIPInstanceID),\r\nInboundMessage(HubScenario.PIPVersion),\r\nHubHelper.ReturnSCWithDocType(PIP3A4ReqMessage, Microsoft.Solutions.BTARN.Shared.MessageCategory.AsyncAction,InboundMessage(HubScenario.PIPCode)))'",
                "runAfter": {
                  "Construct3A4RequestMessage_0f572b9d": [
                    "SUCCEEDED"
                  ]
                }
              }
            },
            "else": {
              "actions": {
                "Construct0C1RequestMessage_42800c2b": {
                  "type": "Compose",
                  "inputs": "@'PIP0C1ReqMessage = ServiceContent'",
                  "runAfter": {}
                },
                "InvokeSubmitRNIFAPI0C1Req_b82f5ea7": {
                  "type": "Compose",
                  "inputs": "@'SubmitRNIFAPI.SubmitMessage(\r\nMicrosoft.Solutions.BTARN.Shared.MessageCategory.AsyncAction,\r\nInboundMessage(HubScenario.DestinationPartyName),\r\nHubHelper.GetNameFromDuns(PIP0C1ReqMessage.toRole.PartnerRoleDescription.PartnerDescription.BusinessDescription.GlobalBusinessIdentifier),\r\nInboundMessage(HubScenario.PIPCode),\r\nInboundMessage(HubScenario.PIPInstanceID),\r\nInboundMessage(HubScenario.PIPVersion),\r\nHubHelper.ReturnSCWithDocType(PIP0C1ReqMessage, Microsoft.Solutions.BTARN.Shared.MessageCategory.AsyncAction,InboundMessage(HubScenario.PIPCode)))'",
                  "runAfter": {
                    "Construct0C1RequestMessage_42800c2b": [
                      "SUCCEEDED"
                    ]
                  }
                }
              }
            },
            "runAfter": {}
          }
        },
        "else": {
          "actions": {
            "CheckForPIP_0f86cb6c": {
              "type": "If",
              "expression": "@equals('PIPCode),\"3A4\")', true)",
              "actions": {
                "Construct3A4ResponseMessage_403b05a4": {
                  "type": "Compose",
                  "inputs": "@'PIP3A4ResMessage = ServiceContent'",
                  "runAfter": {}
                },
                "InvokeSubmitRNIFAPI3A4Res_cd00c45d": {
                  "type": "Compose",
                  "inputs": "@'SubmitRNIFAPI.SubmitMessage(\r\nMicrosoft.Solutions.BTARN.Shared.MessageCategory.AsyncResponse,\r\nInboundMessage(HubScenario.DestinationPartyName),\r\nHubHelper.GetNameFromDuns(PIP3A4ResMessage.toRole.PartnerRoleDescription.PartnerDescription.BusinessDescription.GlobalBusinessIdentifier),\r\nInboundMessage(HubScenario.PIPCode),\r\nInboundMessage(HubScenario.PIPInstanceID),\r\nInboundMessage(HubScenario.PIPVersion),\r\nHubHelper.ReturnSCWithDocType(PIP3A4ResMessage, Microsoft.Solutions.BTARN.Shared.MessageCategory.AsyncResponse, InboundMessage(HubScenario.PIPCode)))'",
                  "runAfter": {
                    "Construct3A4ResponseMessage_403b05a4": [
                      "SUCCEEDED"
                    ]
                  }
                }
              },
              "else": {
                "actions": {
                  "NotSupportedResponse_67bbed32": {
                    "type": "Terminate",
                    "inputs": {
                      "runStatus": "Failed",
                      "runError": {
                        "code": "Terminated",
                        "message": "\"Response PIP is not supported\";"
                      }
                    },
                    "runAfter": {}
                  }
                }
              },
              "runAfter": {}
            }
          }
        },
        "runAfter": {
          "ConstructServiceContent_74fe76a6": [
            "SUCCEEDED"
          ]
        }
      },
      "DefaultSendPort": {
        "type": "ServiceProvider",
        "inputs": {
          "parameters": {
            "entityName": "queue",
            "message": "@triggerBody()",
            "sessionId": "",
            "contentType": "application/json"
          },
          "serviceProviderConfiguration": {
            "connectionName": "servicebus",
            "operationId": "sendMessage",
            "serviceProviderId": "/serviceProviders/serviceBus"
          }
        },
        "runAfter": {
          "CheckForCategory_2f799937": [
            "SUCCEEDED"
          ]
        }
      }
    },
    "outputs": {}
  }
}